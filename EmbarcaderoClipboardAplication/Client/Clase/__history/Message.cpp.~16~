//---------------------------------------------------------------------------

#pragma hdrstop

#include "Message.h"
//---------------------------------------------------------------------------
bool Message::returnBold()
{
	return Bold;
}
bool Message:: returnItalic()
{
	return Italic;
}
bool Message:: returnUnderline()
{
    return Underline;
}
void Message::setBold(bool x)
{
	Bold=x;
}
void Message::setItalic(bool x)
{
  Italic=x;
}
void Message::setUnderline(bool x)
{
  Underline=x;
}
void Message::resetValues()
{
	Bold=false;
	Italic=false;
	Underline=false;
    messageColor = clWindowText;
    username = "";
    messageText = "";
    timestamp = "";
}
bool Message::returnisBold()
{
	return isBold;
}
bool Message::returnisItalic()
{
	return isItalic;
}
bool Message::returnisUnderline()
{
	return isUnderline;
}
void Message::setisBold(bool x)
{
  isBold=x;
}
void Message::setisItalic(bool x)
{
	isItalic=x;
}
void Message::setisUnderline(bool x)
{
      isUnderline=x;
}

//Main

void UserSettings::InterpreteazaMesaje(String receivedText, TRichEdit *richEdit)
{
 if (!richEdit) return; //Verificam existenta, pentru a nu forta crash

	String serverStr = receivedText;


	ExtractTimestamp(serverStr); //Facem rost de timestamp

	// Step 2: Parse username and message
	int colonPos = serverStr.Pos(":");

    if (colonPos > 0)
    {
		// Extract username
        ExtractUsername(serverStr, colonPos);

		// Now serverStr contains only the message part
        messageText = serverStr;

		// Step 3: Extract color
        ExtractColor(messageText);

        // Step 4: Extract style tags
		ExtractStyleTags(messageText);

		// Step 5: Display in RichEdit
        richEdit->SelStart = richEdit->Text.Length();
		richEdit->SelLength = 0;

		// Add username with default style
        richEdit->SelAttributes->Style = TFontStyles();
		richEdit->SelAttributes->Color = clWindowText;
        richEdit->SelText = username + ": ";

        // Build style for message
		TFontStyles style;
        if (isBold) style = style << fsBold;
		if (isItalic) style = style << fsItalic;
        if (isUnderline) style = style << fsUnderline;

        // Apply style and color to message
		richEdit->SelAttributes->Style = style;
        richEdit->SelAttributes->Color = messageColor;
		richEdit->SelText = messageText;

		// Add timestamp with default style
        richEdit->SelAttributes->Style = TFontStyles();
		richEdit->SelAttributes->Color = clWindowText;
        richEdit->SelText = timestamp + "\r\n";
	}
    else
	{
        // System message (no colon found)
		richEdit->SelStart = richEdit->Text.Length();
        richEdit->SelLength = 0;
		richEdit->SelAttributes->Style = TFontStyles();
        richEdit->SelAttributes->Color = clWindowText;
		richEdit->SelText = serverStr + "\r\n";
    }
}

#pragma package(smart_init)
